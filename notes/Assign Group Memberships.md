# Assign Group Memberships (Defensive Notes)

## TL;DR
- Windowsのローカル/ドメイングループへのメンバー追加は、権限昇格・永続化・横展開の起点になりやすい。
- 特に「バックアップ系」「リモート管理系」グループは、実質的に影響が大きい。
- 防御側は「誰が・いつ・どのグループに・誰を追加したか」を監査できる状態が重要。

## Why it matters
グループメンバーシップは、ユーザーの権限と到達可能性（例：リモート管理）を一発で変えられる。
攻撃者は以下を狙うことが多い：
- 権限を増やす（Privilege Escalation）
- リモート操作の足場を作る（Lateral Movement / Persistence）
- 監査されにくい設定を選ぶ（Defense Evasion）

## What changed (concept)
- ローカルグループ/ドメイングループの「メンバー追加」
- “見た目は正規の管理作業”に見える点が厄介

## Telemetry / Detection ideas
### Windows Security Event Log（代表例）
- **ユーザーがローカルグループに追加された**（例：Local group membership changes）
- **ユーザーがドメイングループに追加された**（例：Domain group membership changes）
- 管理者権限を示すログ（例：特権ログオン、管理者ロールでの操作）との相関

> ※環境によってイベントIDは変動/監査ポリシー依存なので、まず「グループ変更がログに残る設定」になっているか確認する。

### 相関で見ると強い
- グループ追加の直後に、同一ユーザーでリモートログオン/管理操作が発生
- 変更実行者が通常その作業をしないアカウント
- 業務時間外の変更、短時間で複数グループへ追加

## Triage checklist (SOC L1)
1. 変更対象：どのユーザーが、どのグループに追加された？
2. 実行者：誰が変更した？（管理者の正当性）
3. 時刻：業務時間内か？承認チケットはあるか？
4. 直後の挙動：追加直後に何をした？（ログオン・プロセス・ネットワーク）
5. 影響範囲：同一実行者が他にも変更してないか？

## Hardening / Prevention
- 重要グループ（管理/リモート/バックアップ）への追加は **最小権限 + 申請/承認** 前提にする
- 重要グループ変更の監査ログを必ず有効化（SIEMでアラート化）
- 特権アカウントはPAM（Privileged Access Management）やJIT（Just-In-Time）運用を検討
- リモート管理は許可範囲を絞る（接続元制限、MFA、踏み台）

## Notes (what I learned)
- “グループに入れるだけ”で到達範囲や操作可能範囲が一気に変わる。
- だからこそ「変更イベントの可視化」と「変更直後の行動監視」が重要。
