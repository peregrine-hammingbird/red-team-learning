# Executable Files / Shortcut Hijacking (Defensive Notes)

## TL;DR
- ショートカット（.lnk）の参照先を書き換えることで、ユーザー操作に紐づく実行フローを差し替えられる。
- 見た目が変わらないケースがあり、ユーザーは気づきにくい。
- 防御は「.lnk変更の監視」と「Explorer配下の不審プロセス起動」の検知が効く。

## Why it matters
ユーザーが日常的にクリックするショートカットを改ざんできると、
- “正規アプリ起動”のつもりで別の処理が走る
- 権限のあるユーザーの操作を踏み台にされる
などのリスクがある（永続化や初期実行の起点）。

## Telemetry / Detection ideas
### 監視ポイント
- デスクトップ/スタートメニュー等の .lnk ファイル変更
- Explorer.exe（または正規アプリ）からの不審な子プロセス起動
  - 例：スクリプトエンジン、コマンド解釈、管理ツール等
- 署名されていないスクリプトや不審な実行引数

### 調査の観点
- “いつ誰が” .lnk を変更したか
- その直後に何が実行されたか（プロセスツリー）

## Triage checklist (SOC L1)
1. 変更されたショートカットはどれ？（場所・所有者）
2. 参照先は何に変わった？（通常と違う？）
3. 実行の痕跡：Explorer配下で不審な子プロセスがいないか？
4. 同様の改ざんが他端末にもないか？（横展開/大量改変）

## Hardening / Prevention
- 重要ショートカットの書き込み権限を絞る（特に管理者のデスクトップ等）
- AppLocker / WDAC などで不審な実行経路を制御
- ASRルール等でスクリプト/不審なプロセス連鎖を抑制
- ファイル整合性監視（FIM）を検討

## Notes (what I learned)
- “実行ファイルを改ざんしなくても”、周辺（ショートカット）で実行フローを奪える。
- 検知は「.lnk変更」＋「プロセスツリー」で見るのが効率的。
